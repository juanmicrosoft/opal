---
title: "Adding OPAL to Existing Projects"
section: "guides"
order: 1
---

# Adding OPAL to an Existing C# Project

This guide walks you through adding OPAL to an existing C# project, from enabling OPAL to building with mixed OPAL/C# code.

---

## Overview

Adding OPAL to an existing project is a gradual process:

1. **Initialize** - Enable OPAL with MSBuild integration
2. **Analyze** - Find files that benefit most from OPAL's features
3. **Write/Convert** - Create new files in OPAL, convert high-scoring C# files
4. **Build** - OPAL compiles automatically with your project

You don't need to convert everything at once. OPAL and C# coexist seamlessly.

---

## Step 1: Enable OPAL in Your Project

Enable OPAL with MSBuild integration:

```bash
# Initialize OPAL in your project
opalc init

# Or specify a specific project file
opalc init --project MyApp.csproj
```

Your `.csproj` is updated with MSBuild targets that compile `.opal` files automatically during `dotnet build`.

---

## Step 2: Analyze Your Codebase

Use `opalc analyze` to find C# files that would benefit most from OPAL:

```bash
# Analyze your source directory
opalc analyze ./src

# Show top 10 candidates with detailed scores
opalc analyze ./src --top 10 --verbose
```

### Understanding the Output

```
=== OPAL Migration Analysis ===

Analyzed: 42 files
Average Score: 34.2/100

Top 10 Files for Migration:
--------------------------------------------------------------------------------
 82/100 [Critical]  src/Services/PaymentProcessor.cs
 78/100 [Critical]  src/Services/OrderService.cs
 65/100 [High]      src/Repositories/UserRepository.cs
```

| Priority | Score | Recommendation |
|:---------|:------|:---------------|
| **Critical** | 76-100 | Convert to OPAL - high benefit |
| **High** | 51-75 | Good conversion candidate |
| **Medium** | 26-50 | Optional - some benefit |
| **Low** | 0-25 | Keep in C# - minimal benefit |

---

## Step 3: Add Your First OPAL File

Create a new `.opal` file alongside your existing code:

```opal
§M[m001:Calculator]

§F[f001:Add:pub]
  §I[i32:a]
  §I[i32:b]
  §O[i32]
  §R (+ a b)
§/F[f001]

§/M[m001]
```

---

## Step 4: Build and Verify

```bash
# Build your project - OPAL compiles automatically
dotnet build
```

The build process:

1. Finds all `.opal` files in your project
2. Compiles each to `.g.cs` in the `obj/opal/` directory
3. Includes generated C# in the normal compilation

---

## Step 5: Convert High-Scoring C# Files

Based on your analysis results, convert files that score High or Critical:

```bash
# Convert a single file
opalc convert src/Services/PaymentProcessor.cs

# With benchmark comparison
opalc convert src/Services/PaymentProcessor.cs --benchmark
```

For bulk conversion:

```bash
opalc migrate ./src --dry-run  # Preview first
opalc migrate ./src            # Execute
```

---

## Optional: Enable Claude Code Integration

For AI-assisted OPAL development:

```bash
opalc init --ai claude
```

This adds:
- `/opal` and `/opal-convert` skills
- `CLAUDE.md` with guidelines instructing Claude to write new code in OPAL and analyze C# files before modifying them

### Using Claude Code

**Write new OPAL code:**
```
/opal

Write a function that validates email addresses with:
- Precondition: input is not null or empty
- Postcondition: returns true only for valid emails
```

**Convert existing C# to OPAL:**
```
/opal-convert src/Services/PaymentProcessor.cs
```

---

## Best Practices

### What to Convert First

1. **High-scoring files** from `opalc analyze`
2. **Files with complex validation** - benefit from contracts
3. **Files with error handling** - benefit from `Result<T,E>`
4. **Files with side effects** - benefit from effect declarations

### What to Keep in C#

- Simple DTOs and record types
- Auto-generated code (EF migrations, gRPC stubs)
- Code using features OPAL doesn't support yet

---

## Next Steps

- [Syntax Reference](/syntax-reference/) - Complete OPAL language reference
- [Contracts](/syntax-reference/contracts/) - Writing preconditions and postconditions
- [Effects](/syntax-reference/effects/) - Declaring side effects
- [opalc analyze](/cli/analyze/) - Understanding migration scores
