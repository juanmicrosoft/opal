---
title: "Interop Effect Coverage"
section: "benchmarking"
order: 12
---


**Category:** Interop Effect Coverage (Calor-only)
**Result:** N/A (no C# equivalent)
**What it measures:** BCL methods covered by effect manifests

---

## Overview

Effect soundness requires knowing what effects external .NET methods have. The BCL (Base Class Library) effect manifest tracks which .NET methods have effect annotations, enabling verification even when Calor code calls external libraries.

This metric measures the coverage of that manifest—how many commonly-used .NET methods have documented effects.

---

## Why It Matters

Without effect coverage for external code, the effect system has gaps:

- Calling `Console.WriteLine` without knowing it has `cw` effect breaks soundness
- Calling `HttpClient.GetAsync` without knowing it has `net:r` effect allows hidden network calls
- Calling `File.ReadAllText` without knowing it has `fs:r` effect makes filesystem access invisible

High interop coverage means:
- Effect declarations remain accurate across .NET interop boundaries
- AI agents can reason about effects even for external library calls
- Strict mode (`--strict-effects`) becomes practical for real projects

---

## How It's Measured

The metric evaluates:

1. **Built-in catalog coverage** - Hardcoded effects for common BCL types
2. **Manifest coverage** - Types and methods declared in effect manifest files
3. **Namespace coverage** - Default effects for entire namespaces

Coverage percentage = (Methods with declared effects) / (Total methods called)

---

## The BCL Effect Manifest

Calor includes a built-in manifest for .NET Base Class Library methods:

### Console I/O

| Type | Method | Effects |
|:-----|:-------|:--------|
| `System.Console` | `WriteLine` | `cw` |
| `System.Console` | `Write` | `cw` |
| `System.Console` | `ReadLine` | `cr` |
| `System.Console` | `Read` | `cr` |

### Filesystem

| Type | Method | Effects |
|:-----|:-------|:--------|
| `System.IO.File` | `ReadAllText` | `fs:r` |
| `System.IO.File` | `ReadAllBytes` | `fs:r` |
| `System.IO.File` | `WriteAllText` | `fs:w` |
| `System.IO.File` | `WriteAllBytes` | `fs:w` |
| `System.IO.File` | `Copy` | `fs:rw` |
| `System.IO.File` | `Delete` | `fs:w` |
| `System.IO.File` | `Exists` | `fs:r` |

### Network

| Type | Method | Effects |
|:-----|:-------|:--------|
| `System.Net.Http.HttpClient` | `GetAsync` | `net:r` |
| `System.Net.Http.HttpClient` | `GetStringAsync` | `net:r` |
| `System.Net.Http.HttpClient` | `PostAsync` | `net:w` |
| `System.Net.Http.HttpClient` | `SendAsync` | `net:rw` |

### Environment

| Type | Method | Effects |
|:-----|:-------|:--------|
| `System.Environment` | `GetEnvironmentVariable` | `env:r` |
| `System.Environment` | `SetEnvironmentVariable` | `env:w` |

### Nondeterminism

| Type | Method | Effects |
|:-----|:-------|:--------|
| `System.DateTime` | `Now` | `time` |
| `System.DateTime` | `UtcNow` | `time` |
| `System.Random` | `Next` | `rand` |
| `System.Guid` | `NewGuid` | `rand` |

---

## Coverage Categories

### Fully Covered

Types where all commonly-used methods have effect declarations:
- `System.Console`
- `System.IO.File`
- `System.Net.Http.HttpClient`
- `System.Environment`

### Partially Covered

Types where key methods are covered but some overloads or less-common methods may be missing:
- `System.IO.FileStream`
- `System.Net.Sockets.TcpClient`
- `System.Data.SqlClient.SqlCommand`

### Namespace Defaults

For types without specific mappings, namespace defaults provide fallback effects:

```json
{
  "namespaceDefaults": {
    "System.IO": ["fs:rw"],
    "System.Net": ["net:rw"],
    "System.Data": ["db:rw"]
  }
}
```

---

## Example: Calling HttpClient

Calor code that makes an HTTP request:

```calor
§F{f001:FetchData:pub}
  §I{str:url}
  §O{str!str}
  §E{net:r}                    // Must declare network read

  §V{v001:HttpClient:client} §NEW{HttpClient} §/N
  §V{v002:str:response} §AWAIT §C{client.GetStringAsync} url §/C
  §R §OK response
§/F{f001}
```

The compiler looks up `HttpClient.GetStringAsync` in the effect manifest:
1. Finds it has `net:r` effect
2. Verifies the function declares `§E{net:r}`
3. Compilation succeeds

If `§E{net:r}` was missing:

```
error Calor0410: Function 'FetchData' uses effect 'net:r'
                 but does not declare it
  Call chain: FetchData → HttpClient.GetStringAsync
```

---

## Contributing to Coverage

You can extend effect coverage with custom manifest files.

### Project-Local Manifest

Create `.calor-effects.json` in your project root:

```json
{
  "version": "1.0",
  "description": "Effects for project dependencies",
  "mappings": [
    {
      "type": "ThirdParty.EmailService",
      "methods": {
        "SendAsync": ["net:w"],
        "ValidateAddress": []
      }
    },
    {
      "type": "MyApp.DataAccess.Repository",
      "defaultEffects": ["db:rw"],
      "methods": {
        "GetById": ["db:r"],
        "GetAll": ["db:r"]
      }
    }
  ]
}
```

### Manifest Search Locations

Manifests are loaded from (later sources override earlier):

1. **Built-in** - Embedded BCL manifests (lowest priority)
2. **User-level** - `~/.calor/manifests/*.calor-effects.json`
3. **Solution-level** - `{solution}/.calor-effects/*.calor-effects.json`
4. **Project-local** - `.calor-effects.json` (highest priority)

### CLI Commands

```bash
# Check what effects are resolved for a method
calor effects resolve HttpClient.GetAsync

# Validate all manifests
calor effects validate

# List all types with effect declarations
calor effects list
```

---

## Effect Taxonomy

The full effect taxonomy used in manifests:

| Code | Effect | Description |
|:-----|:-------|:------------|
| `cw` | Console write | Output to console |
| `cr` | Console read | Input from console |
| `fs:r` | Filesystem read | Read files |
| `fs:w` | Filesystem write | Write files |
| `fs:rw` | Filesystem read/write | Both read and write |
| `net:r` | Network read | HTTP GET, receive data |
| `net:w` | Network write | HTTP POST, send data |
| `net:rw` | Network read/write | Bidirectional network |
| `db:r` | Database read | SELECT queries |
| `db:w` | Database write | INSERT/UPDATE/DELETE |
| `db:rw` | Database read/write | Full database access |
| `env:r` | Environment read | Read env variables |
| `env:w` | Environment write | Set env variables |
| `time` | Time | Time-dependent operations |
| `rand` | Random | Random number generation |
| `proc` | Process | Process operations |
| `mut` | Mutation | Heap mutation |
| `throw` | Exception | May throw exceptions |

---

## Strict Effects Mode

For maximum safety, enable strict effects to error on unknown external calls:

```bash
calor -i app.calr -o app.g.cs --strict-effects
```

This requires all external method calls to have declared effects in manifests.

---

## Next

- [Benchmarking Overview](/benchmarking/) - Return to metrics summary
- [Methodology](/benchmarking/methodology/) - How all benchmarks work
